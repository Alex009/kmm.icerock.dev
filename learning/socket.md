---
sidebar_position: 21
---

# Socket

[че такое сокетное соединение](https://android-tools.ru/coding/sokety-v-android/)

Кейсы, когда нужны именно сокеты, когда сервер должен мочь в любой момент что-то сообщить:
- обновление положения машинки такси на карте
- обновление статуса про курьера
- чатики (чтобы не кидать каждую секунду кидать запрос на получение новых сообщений)
- биржи

На базе сокетного соединения построены рестовые запросы. (http)
- открывается сокетное соедниение
- туда кидаются какие-то данные
- в ответ тоже чето кидается
- обычные запросы соединение прервут

Если сокет открыт вручную - то можно долго держать это соединение. Пуши работают на базе сокетного соединеия. Как только сервак узнает, что надо прислать что-то новое - он кидает в этот сокет кидает сообщение - тебе пуш.
Нужно написать код, чтобы он автоматически реконектился если происходит потеря связи.

## WebSocket
[простенький видос](https://www.youtube.com/watch?v=SxMvxIHBahU)

Еще видос для ознакомления [видос](https://www.youtube.com/watch?v=bTxax4k-b8o) про okHttp и его интерфейс

[про вебсокеты и okHttp](https://www.youtube.com/watch?v=tF0-p4FDepk)

Веб сокеты - они на основе обычных http запросов процедуру установки сокетного соединения делают, они вместо того чтобы после установки соединения и получения ответа разорвать соединение - они оставляют это соединение и переходят в режим сокета - и клиент и сервер могут друг другу чето кидать
Пока специально не разорвут соединение ничего не произойдет.


В чем разница [Socket и WebSocket](https://ru.stackoverflow.com/questions/507746/%D0%92-%D1%87%D0%B5%D0%BC-%D1%80%D0%B0%D0%B7%D0%BD%D0%B8%D1%86%D0%B0-%D0%BC%D0%B5%D0%B6%D0%B4%D1%83-socket%D0%BE%D0%BC-%D0%B8-websocket%D0%BE%D0%BC)

как выглядит со стороны iOS(URLSession)
[Websocket на iOS 13](https://apptractor.ru/info/articles/websockets-ios.html)


[Websocket на Android с OKHttp](https://ssaurel.medium.com/learn-to-use-websockets-on-android-with-okhttp-ba5f00aea988)

Использовать [Ktor Websocket](https://ktor.io/docs/getting-started-ktor-client-multiplatform-mobile.html) можно в мультиплатформе, у них гайд как сделать чат на вебсокетах с KMM  
[Ktor Websocket Client](https://ktor.io/docs/websocket-client.html)



## SocketIO

[сайт](https://socket.io/)
[дока](https://socket.io/docs/v4/)


SocketIO - тот же Websocket, но с другим протоколом обмена данными внутри. Т.е. не удастся на одной стороне заюзать сокетIO а на другой обычный вебсокет.

Прочитайте статью про [разницу между веб-сокетами и Socket.IO](https://habr.com/ru/post/498996/) там будут примеры на JS, не пугайтесь :)

[Использование](https://socket.io/blog/native-socket-io-and-android/) SocketIO в Android

Если у вас сервер не на читстых вебсокетах, а на socket-io то можно использовать нашу библиотеку [moko-soсket-io](../../learning/libraries/moko/moko-socket-io)

## LongPooling-запросы

Есть более простая реализация замены сокетам это LongPooling-запросы

Запрос кидается в сторону сервера, у него очень большое время ожидания ответа. Сервер сразу отвечает если у него есть че ответить, если пока нечего ответить - не отвечает что "ответить нечем" и просто держит соединение. Если таймаут сгорит - то клиент просто задублирует свое сообщение

Легче чем сокет в плане реализации, потому что там пингпонг делать надо. Чтобы лонгпулинг был - надо чтобы у сервера была такая механника в конкретном запросе.
Это чуть больше нагружает сервер, потому что все равно соединение надо поддерживать. А сокет будет душить пингпонгом, и девайс все время будет активен, потому что идет соединение. 

